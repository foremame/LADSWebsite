<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add New Banner</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" th:src="@{/js/CommonMethods.js}"></script>
</head>
<body>
<div class="container">
    <div id="errorDiv" style="display:none">
    </div>
    <form name="cardForm" action="/card/add" method="post">
        <div class="form-group">
            <label for="name">Card Name:</label>
            <input type="text" id="name" name="name" placeholder="Enter Card Name: " required>
        </div>
        <div class="form-group" id="cardOriginDiv">
            <label for="eventOrigin">Card is from an event:</label>
            <input type="radio" id="eventOrigin" name="cardOrigin" value="Event">
            <label for="bannerOrigin">Card is from a banner:</label>
            <input type="radio" id="bannerOrigin" name="cardOrigin" value="Banner">
        </div>
        <div class="form-group" id="eventDiv" style="display:none">
            <label for="eventNameSearch">Event:</label>
            <input type="text" id="eventNameSearch" onkeyup="searchForName('eventNameSearch','eventsUL')" placeholder="Search for event name..">
            <ul id="eventsUL">
                <li th:each="event: ${events}" style="display:none">
                    <input type="radio" th:id="${'Event' + event.id}" name="eventId" th:value="${event.id}">
                    <label th:for="${'Event' + event.id}" th:text="${event.name}"></label>
                </li>
            </ul>
        </div>
        <div class="form-group" id="bannerDiv" style="display:none">
            <label for="bannerNameSearch">Banner:</label>
            <input type="text" id="bannerNameSearch" onkeyup="searchForName('bannerNameSearch','bannersUL')" placeholder="Search for banner name..">
            <ul id="bannersUL">
                <li th:each="banner: ${banners}" style="display:none">
                    <input type="radio" th:id="${'Banner' + banner.id}" name="bannerId" th:value="${banner.id}">
                    <label th:for="${'Banner' + banner.id}" th:text="${banner.name}"></label>
                </li>
            </ul>
        </div>
        <div class="form-group" id="loveInterestDiv" style="display:none">
        </div>
        <div class="form-group" id="rarityTypeDiv" style="display:none">
            <label for="rarityTypes">Card Rarity:</label>
            <select id="rarityTypes" name="rarityType">
                <option value="">--Please Choose An Option--</option>
                <option th:each="rarityType : ${rarityTypes}" th:value="${rarityType}" th:text="${rarityType}"></option>
            </select>
        </div>
        <div class="form-group" id="cardTypeDiv" style="display:none">
            <label for="cardTypes">Card Type:</label>
            <select id="cardTypes" name="cardType">
                <option value="">--Please Choose An Option--</option>
                <option th:each="cardType : ${cardTypes}" th:value="${cardType}" th:text="${cardType}"></option>
            </select>
        </div>
        <div class="form-group" id="stellacrumTypeDiv" style="display:none">
            <label for="stellacrumTypes">Stellacrum:</label>
            <select id="stellacrumTypes" name="stellacrumType">
                <option value="">--Please Choose An Option--</option>
                <option th:each="stellacrum : ${stellacrumTypes}" th:value="${stellacrum}" th:text="${stellacrum}"></option>
            </select>
        </div>
        <div class="form-group" id="mainStatDiv" style="display:none">
            <label for="mainStats">Main Stat:</label>
            <select id="mainStats" name="mainStatType">
                <option value="">--Please Choose An Option--</option>
                <option th:each="mainStat : ${mainStats}" th:value="${mainStat}" th:text="${mainStat}"></option>
            </select>
        </div>
        <button style="display:none" id="btnSubmit" class="submit" type="submit">Submit</button>
    </form>
</div>
<script th:inline="javascript" type="text/javascript">

    $("form").submit( function(e) {
        e.preventDefault();
        $("#errorDiv").hide();
        $("#errorDiv").empty();

        var form = this;
        var issue = false;
        var errorText = "";
        var cardOrigin = $("input[name='cardOrigin']:checked").val();
        var activityId = cardOrigin == "Event" ? $("input[name='eventId']:checked").val() : $("input[name='bannerId']:checked").val();

        if (!activityId) {
            issue = true;
            errorText += "<p>Please select a banner/event.</p>";
        }
        if ($("#loveInterest").val() == "") {
            issue = true;
            errorText += "<p>Please select a love interest.</p>";
        }
        if ($("#rarityTypes").val() == "") {
            issue = true;
            errorText += "<p>Please select a card rarity.</p>";
        }
        if ($("#cardTypes").val() == "") {
            issue = true;
            errorText += "<p>Please select a card type.</p>";
        }
        if ($("#stellacrumTypes").val() == "") {
            issue = true;
            errorText += "<p>Please select a stellacrum color.</p>";
        }
        if ($("#mainStats").val() == "") {
            issue = true;
            errorText += "<p>Please select a main stat.</p>";
        }

        var params = {"cardName" : $("#name").val()};
        validateByUrl("/card/validateCardForm", params, issue, errorText, form);
    });

    $("input[name='eventId']").change( function() {
        var cardOrigin = $("input[name='cardOrigin']:checked").val();
        var activityId = $(this).val();
        populateLoveInterestList(cardOrigin, activityId);
    });

    $("input[name='bannerId']").change( function() {
        var cardOrigin = $("input[name='cardOrigin']:checked").val();
        var activityId = $(this).val();
        populateLoveInterestList(cardOrigin, activityId);
    });

    function populateLoveInterestList(cardOrigin, activityId) {
        url_get("/activityLoveInterest/getLoveInterestListByActivity", {"activityType" : cardOrigin, "activityId" : activityId}).done( function(msg) {
            var lis = JSON.parse(msg);
            $("#loveInterestDiv").hide();
            $("#loveInterestDiv").empty();
            var appendText = '<label for="loveInterest">Love Interest:</label>';
            appendText += '<select id="loveInterest" name="loveInterestType">';
            appendText += '<option value="">--Please Choose An Option--</option>';

            for (var li of lis) {
                appendText += '<option value="' + li + '">' + li + '</option>';
            }

            appendText += "</select>";
            $("#loveInterestDiv").append(appendText);

            $("#loveInterestDiv").show();
            $("#rarityTypeDiv").show();
            $("#cardTypeDiv").show();
            $("#stellacrumTypeDiv").show();
            $("#mainStatDiv").show();
            $("#btnSubmit").show();
        });
    }

    $("input[name='cardOrigin']").change( function() {
        if ($(this).val() == "Event") {
            $("#bannerDiv").hide();
            $("#eventDiv").show();
        }
        else {
            $("#eventDiv").hide();
            $("#bannerDiv").show();
        }
    });
</script>
</body>
</html>